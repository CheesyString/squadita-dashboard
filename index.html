<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Squad Italia Server Dashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 2rem auto;
    padding: 1rem;
    background: #222;
    color: #eee;
  }
  h1 {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
  }
  .status-online {
    color: #43b581;
  }
  .status-offline {
    color: #f04747;
  }
  .field {
    margin-bottom: 1rem;
  }
  .field label {
    font-weight: bold;
    display: block;
    margin-bottom: 0.25rem;
    color: #bbb;
  }
  .field .value {
    font-size: 1.2rem;
  }
  footer {
    margin-top: 3rem;
    font-size: 0.8rem;
    text-align: center;
    color: #666;
  }
</style>
</head>
<body>

<h1>Squad Italia Server Dashboard</h1>

<div id="server-info">
  Loading server info...
</div>

<footer>
  Powered by BattleMetrics API â€” Auto-refresh every 60 seconds
</footer>

<script>
  const SERVER_ID = '34075910';
  const apiUrl = `https://api.battlemetrics.com/servers/${SERVER_ID}`;

  function formatUptime(seconds) {
    if (!seconds) return 'N/A';
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    return `${h}h ${m}m`;
  }

  function shortenTeamName(team) {
    if (!team) return 'Unknown';
    // Take first part before underscore or space
    return team.split(/[_ ]/)[0];
  }

  async function fetchServer() {
    try {
      const res = await fetch(apiUrl);
      if (!res.ok) throw new Error(`API error: ${res.status}`);

      const json = await res.json();
      const attr = json.data.attributes;
      const details = attr.details || {};

      const name = attr.name || 'Unknown';
      const status = attr.status === 'online' ? 'Online' : 'Offline';
      const statusClass = attr.status === 'online' ? 'status-online' : 'status-offline';
      const map = details.map || 'Unknown';
      const gameMode = details.gameMode || 'Squad';
      const players = attr.players ?? 0;
      const maxPlayers = attr.maxPlayers ?? 0;
      const uptime = formatUptime(details.squad_playTime);
      const teamOne = shortenTeamName(details.squad_teamOne);
      const teamTwo = shortenTeamName(details.squad_teamTwo);

      document.getElementById('server-info').innerHTML = `
        <div class="field"><label>Server Name:</label> <div class="value">${name}</div></div>
        <div class="field"><label>Status:</label> <div class="value ${statusClass}">${status}</div></div>
        <div class="field"><label>Map:</label> <div class="value">${map}</div></div>
        <div class="field"><label>Game Mode:</label> <div class="value">${gameMode}</div></div>
        <div class="field"><label>Players:</label> <div class="value">${players} / ${maxPlayers}</div></div>
        <div class="field"><label>Uptime:</label> <div class="value">${uptime}</div></div>
        <div class="field"><label>Factions:</label> <div class="value">${teamOne} vs ${teamTwo}</div></div>
      `;
    } catch (e) {
      document.getElementById('server-info').innerHTML = `<div style="color:#f04747;">Failed to load server info: ${e.message}</div>`;
    }
  }

  fetchServer();
  setInterval(fetchServer, 60000); // Refresh every 60 seconds
</script>

</body>
</html>
